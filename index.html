<!DOCTYPE html>
<html>
<head>
	<title>ThermoController</title>
	<meta charset="UTF-8"/>
	<link rel="stylesheet" href="js/dijit/themes/claro/claro.css"/>
	<link rel="stylesheet" href="index.css?ver=20181206"/>
	<script>dojoConfig = {parseOnLoad: true}</script>
	<script src="js/dojo/dojo.js" data-dojo-config="async: true"></script>
</head>
<body class="claro">

<div id="loading">
loading..
</div>
<div id="content" style="visibility:hidden;">

<div data-dojo-type="dijit/Dialog" data-dojo-id="eTemp" title="Modifica Temperatura">
	<p class="dijitDialogPaneContentArea">
		Temperatura (°C):
		<input data-dojo-type="dijit/form/NumberSpinner" data-dojo-id="eTempVal" smallDelta=0.1 style="width:6em;" constraints="{ min:-100,max:100,places:1}"/>
    <table id="eTempTable">
    </table>
	</p>
    <div class="dijitDialogPaneActionBar">
        <button data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){sts.saveTemp(eTemp.attr('minOrMax'),eTempVal.get('value'));}">Salva</button>
        <button data-dojo-type="dijit/form/Button" type="button" data-dojo-props="onClick:function(){eTemp.hide();}">Annulla</button>
    </div>
</div>

<div id="status-area">

    <div id="status-info">
        <div id="power-box" class="col">
            <img alt="pwr" class="info-icon" id="power-led" src="images/spento.png?1"/>
            <div class="col">
                <div>
                    <button data-dojo-id="status_master_on" data-dojo-type="dijit/form/Button" data-dojo-props="onClick:function(){sts.confirm('Attivare impianto?','Attiva!','activate')}">
                        Accendi impianto
                    </button>
                </div>
                <div>
                    <button data-dojo-id="status_master_off" data-dojo-type="dijit/form/Button" data-dojo-props="onClick:function(){sts.confirm('Disattivare impianto?','Disattiva!','deactivate')}">
                        Spegni impianto
                    </button>            
                </div>
            </div><!--col-->  
        </div><!--power box-->    
        <div id="mode-box" class="col">		
            <div class="col">
                <div>
                    <button data-dojo-id="status_manual" data-dojo-type="dijit/form/Button" data-dojo-props="onClick:function(){sts.confirm('Passare in MANUALE?','Manuale!','manual')}">
                        Manuale
                    </button>
                </div>
                <div>
                    <button data-dojo-id="status_auto" data-dojo-type="dijit/form/Button" data-dojo-props="onClick:function(){sts.confirm('Passare in AUTOMATICO?'+ (sts.status.warnings.modeswitch!=''?'<p>ATTENZIONE: '+sts.status.warnings.modeswitch+'</p>':''),'Automatico!','auto')}">
                        Automatico
                    </button>
                </div>
            </div><!--col-->
            <img alt="mde" class="info-icon" id="mode-led" src="images/manual.png?1"/>
        </div><!-- mode box -->
    </div><!-- status info-->
      
    <div id="status-main">
    
    <div>
      
        <div id="temp-pane-curr" class="status-boxes">
            <div class="status-title">
                Temperature attuali
            </div>
            <div id="temp-stats">
                Temperatura: <span id="temp-label"></span>
            </div>
            <div>
                Umidità: <span id="humi-label"></span>
            </div>
            <div>
                <span id="update-time">--</span>
            </div>
        </div><!-- temp pane-->

        <div id="temp-pane" class="status-boxes">
            <div class="status-title">
                Temperature impostate
            </div>
            <div>
                <img alt="minTemp" class="temp-img" src="images/min-temp.png?1"/>
                <button data-dojo-id="min_temp_m" data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){sts.saveTemp('min',sts.status.temp.min-0.1)}">
                    -
                </button>
                <button data-dojo-id="min_temp" data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){sts.setTemp(sts.status.temp.min,'min','Cambia temperatura minima')}">
                    XX.X°C                
                </button>
                <button data-dojo-id="min_temp_p" data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){sts.saveTemp('min',sts.status.temp.min+0.1)}">
                    +
                </button>  
            </div>
            <div>
                <img alt="maxTemp" class="temp-img" src="images/max-temp.png?1"/>
                <button data-dojo-id="max_temp_m" data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){sts.saveTemp('max',sts.status.temp.max-0.1)}">
                    -
                </button>                
                <button data-dojo-id="max_temp" data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){sts.setTemp(sts.status.temp.max,'max','Cambia temperatura massima')}">
                    XX.X°C                
                </button>
                <button data-dojo-id="max_temp_p" data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){sts.saveTemp('max',sts.status.temp.max+0.1)}">
                    +
                </button>
            </div>
        </div><!-- temp pane-->

    </div>
    
    <div id="pellet-status" class="status-boxes">
            <div class="status-title">
                Stufa a pellet
            </div>
            <div>
                <div class="col">
                    <div>
                        <button data-dojo-id="pellet_on" data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){sts.confirm('Accendo il PELLET?','Accendi!','pellet-on')}">
                            Accendi
                        </button>                    
                    </div>
                    <div>
                        <button data-dojo-id="pellet_minimum_on" data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){sts.confirm('Pellet al MINIMO?','al minimo!','pellet-minimum-on')}">
                            minimo
                        </button>                    
                    </div>
                </div>
                <div class="col">
                            <img alt="psl" class="status-icon" id="pellet-status-led" src="images/pellet-off.png?1"/>
                </div>
                <div class="col">
                            <div>
                                <img alt="fml" class="status-icon-flame celated" id="pellet-flameout-led" src="images/flameout.png?1"/>
                            </div>
                            <div>
                                <img alt="pfl" class="status-icon-temp" id="pellet-feedback-led" src="images/min-temp.png?1"/>
                            </div>
                            <div>
                                <img alt="pmsl" class="status-icon-sub" id="pellet-minimum-status-led" src="images/pellet-modulazione.png?1"/>
                            </div>
                </div>
                <div class="col">
                    <div>
                        <button data-dojo-id="pellet_off" data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){sts.confirm('Spengo il PELLET?','Spegni!','pellet-off')}">
                            Spegni
                        </button>                    
                    </div>
                    <div>		
                        <button data-dojo-id="pellet_minimum_off" data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){sts.confirm('Pellet in modulazione?','in modulazione!','pellet-minimum-off')}">
                            modulazione
                        </button>                    
                    </div>
                </div>
            </div>
        </div><!-- pellet status-->
            
    <div id="gas-status" class="status-boxes">
            <div class="status-title">
                Caldaia a gas
            </div>
            <button data-dojo-id="gas_on" data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){sts.confirm('Accendo il GAS?','Accendi!','gas-on')}">
                Accendi
            </button>                    
            <img alt="gl" class="status-icon" id="gas-status-led" src="images/gas-off.png?1"/>
            <button data-dojo-id="gas_off" data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){sts.confirm('Spengo il GAS?','Spegni!','gas-off')}">
                Spegni
            </button>                    
        </div><!-- gas status-->

    </div><!-- status main-->
    
    <div id="events">
        <div>
            <div>
                <input data-dojo-id="eventsUseRange" data-dojo-type="dijit/form/CheckBox" onChange="evt.toggleRange();"/>
                Scegli periodo
                <img id="events-size" src="images/enlarge.png?1" class="temp-img" style="margin-left: 3em;"/>
            </div>
            <div id="events-range" class="hidden">
                Dal:
                <input data-dojo-id="eventsStart" type="text" value="" data-dojo-type="dijit/form/DateTextBox" /> 
                al:
                <input data-dojo-id="eventsEnd" type="text" value="" data-dojo-type="dijit/form/DateTextBox" />
                <button data-dojo-id="eventsRangeUpdate" data-dojo-type="dijit/form/Button" onClick="evt.update()" type="button">Aggiorna!</button>
            </div>
        </div>
    </div>
    <div id="messages">
        <div id="messages-queue"></div>
    </div>

</div><!-- status area-->
    
<div id="program-area">
  <div id="program-header">
    <div id="today-table-div">
    </div>
    <div><button id="program-size">Programma</button></div>
  </div>
  <div id="program-editor" class="hidden">
    <div id="program-selector">
      <div id="select-pelletgas" class="hot-prg" >
        <img alt="x" id="select-pelletgas-img" src="images/pellet-gas-1.png?1"/>
        <span>Gas+Pellet</span>
      </div>
      <div id="select-gas" class="hot-prg">
        <img alt="g" id="select-gas-img" src="images/gas.png?1"/>
        <span>Gas</span>
      </div>
      <div id="select-pellet" class="hot-prg">
        <img alt="p" id="select-pellets-img" src="images/pellet.png?1"/>
        <span>Pellet</span>
      </div>
  	  <div id="select-off" class="cold-prg">
  		 <img alt="o" id="select-off-img" src="images/off-select-1.png?1"/>
         <span>Gas</span>
      </div>
      <div id="select-pellet-minimum" class="cold-prg">
        <img alt="m" id="select-pellet-minimum-img" src="images/pellet-min-1.png?1"/>
        <span>Pellet</span>
      </div>
    </div>
  	<div id="program-change" class="celated">
      <img id="program-apply" class="button-img" src="images/apply.png?1"/>
      <span id="program-changed">Salvare il programma modificato?</span>
      <img id="program-restore" class="button-img" src="images/restore.png?1"/>
    </div>
    <div id="program-content">
      <div>
        <span>Modifica giornata di</span>
        <select id="program-day-select">
        </select>
      </div>
      <div id="program-table">
      </div>
    </div>
  </div>
</div><!-- program area-->

<div id="history-area">
  <div id="history-controls">
	 <div>
        <div>
            <input data-dojo-id="historyUseRange" data-dojo-type="dijit/form/CheckBox" onChange="hst.toggleRange();"/>
            Scegli periodo
        </div>
		<div id="history-range" class="hidden">
			Dal:
			<input data-dojo-id="historyStart" type="text" value="" data-dojo-type="dijit/form/DateTextBox" /> 
			al:
			<input data-dojo-id="historyEnd" type="text" value="" data-dojo-type="dijit/form/DateTextBox" />
			<button data-dojo-id="historyRangeUpdate" data-dojo-type="dijit/form/Button" onClick="hst.update()" type="button">Aggiorna!</button>
		</div>
        <div>
            <input id="show-temp" data-dojo-type="dijit/form/CheckBox" value="1" checked onChange="hst.drawGraph()"/>Temperatura
            <input id="show-humi" data-dojo-type="dijit/form/CheckBox" value="2" onChange="hst.drawGraph()"/>Umidità
            <input id="show-ext-temp" data-dojo-type="dijit/form/CheckBox" value="3" checked onChange="hst.drawGraph()"/>Temperatura esterna
            <input id="show-ext-humi" data-dojo-type="dijit/form/CheckBox" value="4" onChange="hst.drawGraph()"/>Umidità esterna
            <img id="history-size" src="images/enlarge.png?1" class="temp-img" style="margin-left: 3em;"/>
        </div>
    </div>
    <div>
		<div id="history-stats">
			<div id="history-stats-t">
				<div id="history-stats-te"></div>
				<div id="history-stats-ex"></div>
			</div>
			<div id="history-stats-h">
				<div id="history-stats-hu"></div>
				<div id="history-stats-hx"></div>
			</div>
		</div>
    </div>
    <div>
        <button data-dojo-id="history_zoom_omin" data-dojo-type="dijit/form/Button" onClick="hst.fuzzle(-1,1)" type="button">|&lt;</button>
        <button data-dojo-id="history_zoom_left" data-dojo-type="dijit/form/Button" onClick="hst.fuzzle(-1,1)" type="button">&lt;&lt;</button>
        <button data-dojo-id="history_zoom_out" data-dojo-type="dijit/form/Button" onClick="hst.fuzzle(0,1.2)" type="button">+</button>
        <button data-dojo-id="history_zoom_reset" data-dojo-type="dijit/form/Button" onClick="hst.fuzzle(0,0)" type="button">=</button>
        <button data-dojo-id="history_zoom_in" data-dojo-type="dijit/form/Button" onClick="hst.fuzzle(0,0.8)" type="button">-</button>
        <button data-dojo-id="history_zoom_right" data-dojo-type="dijit/form/Button" onClick="hst.fuzzle(100,1)" type="button">&gt;&gt;</button>
        <button data-dojo-id="history_zoom_omax" data-dojo-type="dijit/form/Button" onClick="hst.fuzzle(-100,1)" type="button">&gt;|</button>
    </div>
</div><!-- history controls-->
    <div id="history-graph">
    </div>
    <div id="history-legend">
    </div>
</div><!-- history area-->

<div id="stats-area">
  <div id="stats-controls">
	 <div>
        <div>
            <input data-dojo-id="statsUseRange" data-dojo-type="dijit/form/CheckBox" onChange="sta.toggleRange();"/>
            Scegli periodo
        </div>
		<div id="stats-range" class="hidden">
			Dal:
			<input data-dojo-id="statsStart" type="text" value="" data-dojo-type="dijit/form/DateTextBox" /> 
			al:
			<input data-dojo-id="statsEnd" type="text" value="" data-dojo-type="dijit/form/DateTextBox" />
			<button data-dojo-id="statsRangeUpdate" data-dojo-type="dijit/form/Button" onClick="sta.update()" type="button">Aggiorna!</button>
		</div>
		<div>
            <div>
                <input id="stats-show-a" data-dojo-type="dijit/form/CheckBox" value="1" checked onChange="sta.drawGraph()"/>Tempi:
                
                Pellet (
                <input id="stats-show-p" data-dojo-type="dijit/form/CheckBox" value="1" checked onChange="sta.drawGraph()"/>modulazione
                <input id="stats-show-pl" data-dojo-type="dijit/form/CheckBox" value="2" checked onChange="sta.drawGraph()"/>minimo
                ) 
                <input id="stats-show-g" data-dojo-type="dijit/form/CheckBox" value="3" checked onChange="sta.drawGraph()"/>Gas
            </div>
            <div>
                Temperature:
                <input id="stats-show-ti" data-dojo-type="dijit/form/CheckBox" value="4" onChange="sta.drawGraph()"/>interne
                <input id="stats-show-te" data-dojo-type="dijit/form/CheckBox" value="5" onChange="sta.drawGraph()"/>esterne
                (
                <input id="stats-show-tmin" data-dojo-type="dijit/form/CheckBox" value="6" checked onChange="sta.drawGraph()"/>min
                <input id="stats-show-tmax" data-dojo-type="dijit/form/CheckBox" value="7" checked onChange="sta.drawGraph()"/>max
                <input id="stats-show-tavg" data-dojo-type="dijit/form/CheckBox" value="8" checked onChange="sta.drawGraph()"/>avg
                )
        </div>
        <div id="stats-total">
			<div>
				<span id="stats-total-pellet"></span>
				<span id="stats-total-pellet-mod"></span>
				<span id="stats-total-pellet-min"></span>
			</div>
			<div id="stats-total-gas">
			</div>
		</div>
    </div>
    </div>
    </div><!-- stats controls-->
    <div id="stats-graph">
    </div>
    <div id="stats-legend">
    </div>
</div><!-- stats area-->

</div>


<script src="utils.js?20181229_"></script>
<script src="production.js?20181129_"></script>
<script src="status.js?20181229__"></script>
<script src="events.js?20181206"></script>
<script src="program.js?20181229_"></script>
<script src="history.js?20181206"></script>
<script src="stats.js?20181230_"></script>
<script language="javascript">
require([
    "dojo/ready",
    "dojo/dom-class",
    "dojo/dom-style",
    "dojo/parser"], 
function(ready,dclass, style)
{
	ready(function(){
        dclass.toggle("loading", "hidden");
        style.set("content", "visibility", "visible");
        sts.update();
        evt.update();
        window.setTimeout( function(){ 
            hst.startup();
            sta.startup();
        }, 500 );
	});
});
</script>
</body>
</html>
